@model SAEE_Web.Entities.UserEnt

@{
    ViewBag.Title = "RecoverPassword";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<main class="contacts">
    <section class="contacts_form">
        <div class="container">
            <div class="contacts_form-header">
                <h4 class="contacts_form-header_title">Recuperar contraseña</h4>
            </div>
            @if (!string.IsNullOrEmpty(ViewBag.BoxSuccess))
            {
                <div class="alert alert-success" role="alert" style="text-align:center">
                    @ViewBag.BoxSuccess
                </div>

                <script>
                        setTimeout(function () {
                            window.location.href = '@Url.Action("Login", "User")';
                        }, 2000);
                </script>
            }
            @if (!string.IsNullOrEmpty(ViewBag.BoxMessage))
            {
                <div class="alert alert-danger" role="alert" style="text-align:center">
                    @ViewBag.BoxMessage
                </div>

               
            }



            @using (Html.BeginForm("RecoverPassword", "User", FormMethod.Post, new { @class = "contacts_form-form", id = "recoverForm" }))
            {    <hr />
                <h5 style="font-weight:lighter">Ingrese los datos que coincidan con su cuenta</h5>

                <div class="form-group">
                    <label style="margin-right: 53rem;">Email:</label>
                    @Html.TextBoxFor(m => m.Email, new { @class = "field required", @type = "text", @placeholder = "Email", id = "emailInput" })
                </div>

                <div class="form-group">
                    <label style="margin-right: 25rem;">Fecha de nacimiento:</label>
                    @Html.TextBoxFor(m => m.Birthdate, new { @class = "field required", @type = "date", @placeholder = "Fecha de nacimiento", id = "birthdateInput" })
                </div>

                <div class="form-group">
                    <label style="margin-right: 25rem;">Número de teléfono:</label>
                    @Html.TextBoxFor(m => m.PhoneNumber, new { @class = "field required", @type = "number", @placeholder = "Número de teléfono" , id="phoneNumberInput"})
                </div>

                <div class="contacts_form-form_footer">
                    <button type="button" class="btn btn--login" style="color:white;" onclick="validateForm()">RECUPERAR</button>
                </div>
            }
        </div>
    </section>
</main>


@{
    string at = "@";
}

<script>


    var at = "@Html.Raw(at)";

    function validateForm() {
    var formIsValid = true;
    $(".field.required").each(function () {
    if ($(this).val().trim() === "") {
    formIsValid = false;
    $(this).css("border-color", "red");
    if (!$(this).next().hasClass("error-message")) {
    $(this).after("<p class='error-message' style='color: red; text-align: left;'>Este campo es obligatorio.</p>");
    }
    } else {
    $(this).css("border-color", "");
    $(this).next(".error-message").remove();

    //Si hay datos entonces se valida el correo manualmente
    if ($(this).attr("id") === "emailInput") {
    var email = document.getElementById("emailInput").value;

    var hasAnAt = email.includes(at);
    if (hasAnAt) {
    var hasADot = email.split(at)[1].includes(".");
    }

    if (!hasAnAt || !hasADot) {
    $(this).after("<p class='error-message' style='color: red; text-align: left;'>El valor debe corresponder a un correo electrónico.</p>");
    formIsValid = false;
    }
    }
    }
    });

    if (formIsValid) {
    $('#recoverForm').submit();
    }
    }

    </script>
